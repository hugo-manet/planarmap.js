<html>
<head>
<style>
html, body {
	width: 100%;
	height: 100%;
	margin: 0;
	padding: 0;
}
#pmap {
	width: 100%;
	height: 100%;
	top: 0;
	left: 0;
}
svg path.edge {
	stroke: #905070;
	stroke-width: 0.05;
	fill: none;
}
svg path.face {
	stroke: node;
	fill: #c0c0ff;
}
svg text.label {
	pointer-events: none;
	font-family: Verdana;
	font-size: 0.3;
}
svg circle.node {
	fill: red;
}
</style>
</head>
<body>
<div id="pmap">
</div>

<script charset="utf-8" src="./thirdparty/d3/d3.js"></script>
<script src="geometry.js"></script>
<script src="layout.js"></script>
<script src="force.js"></script>
<script src="planarmap.js"></script>
<script src="view.js"></script>
<script>
var svg = d3.select("#pmap").append("svg")
	.attr("id","pmapsvg")
	.attr("width","100%")
	.attr("height","100%")
	.attr("viewBox","-8 -5 16 10")
	.attr("preserveAspectRatio", "xMidYMid meet")	
	
var stopRunning = true;
var planarmap = CMap.PlanarMap();
var layoutupdater = CMap.LayoutUpdater()
	.registerAll(planarmap);
planarmap.singleEdgeMap();

var view = CMap.View(planarmap,svg);

var force = CMap.force(planarmap)
	.centerPull({pull: true, center: new Vec2(0,0), coupling: 0.4})
	.on("tick",view.updatePositions)
	.resume();

function check(){
	console.assert(planarmap.checkIncidence(),"Incidence error");
	console.assert(!CMap.planarMapIsNonSimple(planarmap),"non-simple");
	view.updateLayers();
}
function randomInteger(min,max) {
	return Math.floor(Math.random() * (max-min+1))+min;
}
var runner;
function doStuff(){
	if( planarmap.numEdges() > 20 )
	{
		planarmap.singleEdgeMap();
	}
	if( Math.random() > 0.3 )
	{
		planarmap.insertEdgeNextTo(
			planarmap.edges().random().getOriented( Math.random() < 0.5 ) );
	} else
	{
		var face = planarmap.edges().random().left;
		var index1 = randomInteger(0,face.edges.length-1);
		var index2 = randomInteger(0,face.edges.length-1);	
		planarmap.insertDiagonal(face,[index1,index2]);	
	}
	check();
	return false;
}
function toggleRun(){
	stopRunning = !stopRunning;
	if( !stopRunning )
	{
		runner = setInterval(doStuff,500);
	} else
	{
		clearInterval(runner);
	}
}
toggleRun();




</script>
</body>
</html>

